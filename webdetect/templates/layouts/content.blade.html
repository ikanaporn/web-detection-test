<center>
<div class="container-fluid">
    <div class="row">
      <center>
      <div class="col">
        <video id="video" width="480" height="360" autoplay></video>
        <br>
        <center><button id="snap">Snap Photo</button></center>
      </div>
      <div class="col">
        <canvas id="canvas" width="480" height="360"></canvas>
      </div>
      <div class="col">
        <canvas1 id="results"></canvas1>
        <h3 id="identify-score"></h3>
      </div>
    </center> 
    </div>
</div>


<!-- <script type="text/javascript" src="webcamjs/webcam.min.js"></script> -->


<script>
    // Grab elements, create settings, etc.
    var video = document.getElementById('video');
    // Elements for taking the snapshot
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    //window.ctx = canvas.getContext("2d");
    var video = document.getElementById('video');
    var data = null;
    // Get access to the camera!
    if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        // Not adding { audio: true } since we only want video now
        navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
            //video.src = window.URL.createObjectURL(stream);
            video.srcObject = stream;
            video.play();
        });

    }

    document.getElementById("snap").addEventListener("click", function() {
        img = context.drawImage(video, 0, 0, canvas.width, canvas.height);

        var jpegFile = canvas.toDataURL("image/jpeg");
        var base64 = jpegFile.substring(23);
        var binary = fixBinary(atob(base64));
        var blob = new Blob([binary], {type: 'image/jpeg'});
        // console.log("blobbb",blob);
        // console.log("fileData",jpegFile);

        var file = new File([blob], "image.png");
        //console.log("fileee",file);
        lastMod = lastModified();

        let formData = new FormData();
        
        formData.append("image", file );
        console.log("formData",formData);
        //fetch('http://127.0.0.1:5000/api/working/image-detect', {
        fetch('http://riorocker97.com/api/detect', {
            method: "POST", 
            body: formData
        }).then(response => response.json())

        .then(json => {
            console.log("5555555555 respom",json.image);
            console.log("identify_and_conf",json.identify_and_conf)
            var newChild = '<img src="data:image/jpeg;base64,' + json.image+'"'+ '/>';
            var newIdenConf = '<h3>'+json.identify_and_conf+'</h3>'
            document.getElementById("results").innerHTML = newChild; 
            document.getElementById("identify-score").innerHTML = newIdenConf; 


          });
        
            
    });

    function lastModified() {
      var modiDate = new Date(document.lastModified);
      var showAs = modiDate.getDate() + "-" + (modiDate.getMonth() + 1) + "-" + modiDate.getFullYear();
      return showAs
    }

    function fixBinary (bin) {
      var length = bin.length;
      var buf = new ArrayBuffer(length);
      var arr = new Uint8Array(buf);
      for (var i = 0; i < length; i++) {
        arr[i] = bin.charCodeAt(i);
      }
      return buf;
  }


   

</script>
