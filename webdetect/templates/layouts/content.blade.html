<div id="page-wrapper">
    <div class="container-fluid">
        <!-- Page Heading -->
        <div class="row" id="main" >
            <div class="col-sm-12 col-md-12 well" id="content">
                <h2>Detect Object ddd <h1>{{ data }}<h1></h2> 
                    <center>
                        <video id="video" width="640" height="480" autoplay></video>
                        <button id="snap">Snap Photo</button>
                        <canvas id="canvas" width="640" height="480"></canvas>
                    <!-- <video autoplay id=webcam width="600px" height="400px"></video> -->
                        <!-- <div style="padding: 10px;"><input type="file" accept="image/*;capture=camera"></div> -->
                        <div id="results"></div>
                    </center> 
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</div>

<!-- <script type="text/javascript" src="webcamjs/webcam.min.js"></script> -->
<script>
    // Grab elements, create settings, etc.
    var video = document.getElementById('video');
    // Elements for taking the snapshot
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    var video = document.getElementById('video');
    // Get access to the camera!
    if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        // Not adding `{ audio: true }` since we only want video now
        navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
            //video.src = window.URL.createObjectURL(stream);
            video.srcObject = stream;
            video.play();
        });
    }

   // Trigger photo take
    document.getElementById("snap").addEventListener("click", function() {
        img = context.drawImage(video, 0, 0, 640, 480);
        //test();
        console.log("test test");
        //send_image(img);
        uploadImage(img);
    });

    Webcam.set({
        width: 350,
        height: 350,
        image_format: 'jpeg',
        jpeg_quality: 90
    });

    // send_image(img);
    // console.log("sss");
    // function takes_snapshot(){
    //     Webcam.snap(function(data_uri){
    //         document.getElementById('results').innerHTML = '<img src="'+data_uri+'"/>';
    //         alert("snap success");
    //     }).then(function(data_uri) {
    //         alert("aletrurdd dss");
    //         // send_image(data_uri);
    //     }
           
    //     );
    // }
    function test(){
        //etch('http://riorocker97.com/api/test')
        fetch('http://127.0.0.1:5000/api/test')
        .then(res => res.json())
        
    }
    

    // function send_image(img) {
    //     //console.log(img);
    //     fetch('http://127.0.0.1:5000/api/working/image-detect',
    //     {
    //         method: 'POST',
    //       //  method: 'POST', // *GET, POST, PUT, DELETE, etc.
    //         //credentials: 'include',
    //         headers: {
    //             "Content-Type": "application/json",
    //         },
    //         body: img
    //     }
    //     ).then(function(response) {
    //         console.log('res');
    //         return response.json();
    //     }).catch(error => {
    //         alert('err',error);
    //     });
    //     console.log("test sentsss");
    // }
    function uploadImage(file) {
         // add file to FormData object
        const fd = new FormData();
        fd.append('avatar', file);

        // send `POST` request
        fetch('http://127.0.0.1:5000/api/working/image-detect', {
            method: 'POST',
            body: fd
        })
        .then(res => res.json())
        .then(json => console.log(json))
        .catch(err => console.error(err));
    }

    
    
</script>



